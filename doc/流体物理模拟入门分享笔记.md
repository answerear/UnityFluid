# 流体模拟入门分享



---

## 认识流体

在做流体模拟之前，我们首先需要对流体有一个简单的初步认识。那么，什么是流体呢？

流体是液体和气体的统称，指那些**易于流动的物质**，是区别于固体的物质。但这个定义不太明确，什么样才是**易于流动**呢？

所以，要正确理解流体和固体的区别，首先要理解**什么是流动**，流动是指**不断变形的运动**，这里变形指的是**物体的形状发生了变化**。

水装在矿泉水瓶里的时候，我们是不能判断它是液体还是固体的，当我们想把水倒出来的时候，能流出来的是水，流不出来的是冰。也就是说，判断一种物质是不是流体，不是从它的成分判断的，而是根据它**受力时的运动状态**。

固体可以放在桌子上保持静止，而流体就必须装在容器中才行。原因是只有装在容器中，才能使流体不受**剪切力**作用。流体的内部只要存在剪切力，就不可能处于静止状态，而是会**不断地发生角变形运动**，也就是流动。

所以，我们可以给流体下一个严格的定义：**在任意小的剪切力作用下，都会发生连续不断的角变形的物质**。

---

## 观察流体

在对流体有了初步的认识之后，我们就可以对流体运动进行观察和研究了。

在对流体进行研究时，通常有两种视角：拉格朗日视角和欧拉视角。

其中拉格朗日视角将流体视为流动的单元，例如将一片羽毛放入风中，那么羽毛的轨迹可以帮我们指示空气的流动规律；而欧拉视角则是坐标系固定，如同站在河边观察河水的流动一样；

左边展示的是基于拉格朗日视角的模拟，也是我们前面开场动画里的展示的基于位置的动力学的模拟，可以看到，它其实就是采用各种各样的粒子，然后通过各种方式给物体连接起来；然后这个粒子可以表示降落伞的绳子，这个降落伞下面栓的是个兔子，我们不仅可以用这个粒子来模拟水，还可以用它来模拟各种各样的东西；

而右边则是一个典型的欧拉表示的烟雾模拟，其实这个里面其实就是一般是用一个背景的网格，然后网格上的每一个点表示的是穿过这个点的流体的速度。

那左边这个基于粒子的模拟呢，它的每一个粒子表示的是这个粒子它会携带什么？一般会携带它自己的速度和位置。

所以一个常见的问题就是，欧拉的网格里面的每个点，我们是不记它的位置的，因为它的位置很容易算出来，对吧？因为你可以通过它的 i，j，k下标，然后乘上一个 delta x，你就知道这个网格的格点的位置是在什么地方，但是拉格朗日粒子里面，我们会在粒子上面额外的记一个位置，因为这个粒子的位置会随着被模拟的介质的状态被不断地移动。

总的来说，这两个视角只是从不同观点出发，研究同一个运动。



---

## 大名鼎鼎的NS方程

NS方程也就是纳维-斯托克斯方程，可以说是流体力学的“白月光”。它在流体力学界的地位相当于经典力学中的牛顿三大运动定律，它们描述的是气体和液体的运动在不同的环境里会如何演化。现在已经被广泛的用来模拟从海流、到飞机起飞后的湍流、再到流经心脏的血液流动等各个领域。

这些方程的历史可追溯到19世纪20年代：

欧拉建立了描述理想流体运动的微分方程，奠定了“白月光”故事的基调。

纳维在1761年提出了流体运动的粘度理论。

柯西在欧拉方程中引入流体微团的应力张量的概念，推导出了著名的柯西动量方程。

结合纳维对粘度的思考和柯西的张量思维，斯托克斯便大展神威，推出了引无数流体人尽折腰的“N-S方程”。

也就是**作为最普适的流体运动方程，它适用于可压缩变粘度的粘性流体的运动**。

当物理学家认为这些方程的可靠性就如实锤一样实时，数学家却对它们投以十分谨慎的目光。在数学家眼中，这些方程的运作似乎并不对。他们想要证明的是这些方程是真的可靠的：**无论是什么流体，也无论对其流动的预测发生在多远的未来，这些方程的数学仍保持正确**。而这种愿望已被证明是非常难以达到的。因此，三维空间中的N-S方程组的光滑解的存在性问题被美国克雷数学研究所设定为七个千禧年大奖难题之一。

光滑解要求的是最大化信息量，它们要求在与流体相关的向量场内， 每个点都存在一个向量。但如果我们放松这一要求，比如只需要能够计算某些点上的向量，或者只需对向量的计算进行估算呢？这样的解称为**“弱”解**。它们让数学家对一个方程的行为有个大致个把握，而不需要做找光滑解的所有工作。从某些角度来看，弱解比实际的解更容易描述，因为需要知道的信息更少。

弱解是以渐弱的状态出现的。如果将光滑解看作是一张有着无限精细的分辨率的流体数学图像，那么弱解就像是这张图片的32位、16位或8位版本，取决于你想要的微弱程度。

另外根据不同的研究场景，NS方程还可以做一些简化，比如我们更常用的不可压缩流动。

接下来我们就讲一下简化版的NS方程，以及求它的“弱”解的一些方法。

---

## 向量微分基础

在开始介绍NS方程之前，我们需要回顾一下几个比较重要的向量微分基础知识：Nabla算子、梯度、散度、旋度和拉普拉斯算子。

首先是Nabla算子，也被称为向量微分算子，一般读作"del"，它可以直接作用于函数，得到梯度，也可以与非标量函数作点积，得到散度，还可以与非标量函数作叉积，得到旋度。

梯度：函数u=f(x,y,z)的梯度定义为：偏f偏x，偏f偏y，偏f偏z所组成的一个三维向量，也就是相当于del f

关于梯度，有两个非常重要的性质：
第一个性质，可微函数沿梯度的方向导数最大，最大的方向导数是梯度的模。
第二个性质，梯度向量和f(x,y,z)的等值曲面是垂直的，也就是说梯度向量的法向量，所以我们可以通过求函数的梯度向量得到等值面的法向量。

下面我们来看散度的概念：散度的概念是针对于向量场的，对于向量场A=(P(x,y,z),Q(x,y,z),R(x,y,z))，如果分量函数P Q R，它的偏导数存在的话，我们称偏P偏x加上偏Q偏y加上偏R偏z是A在xyz这一点的散度；这就是向量场散度的概念。我们可以把它形式上地写成向量点乘的形式，也就是del与A做点乘。

那么散度的实际意义是什么呢？

散度实际上是向量场在点上的通量密度。

什么叫通量的密度呢？

对于空间中的一点M，以M为中心，r为半径作一个球，Σ_r是球面，求向量场通过Σ_r的通量，也就是向量场A沿曲面Σ_r的曲面积分除以Σ_r所围成的球体的体积，这表示单位体积通量

当r趋向于0的时候，所对应的比值极限，就是向量场A在M这一点的散度，所以散度是向量场通量的密度。

如果这个向量场是个流速场的话，它表示的是在M这一点，流体流进或流出的强弱程度

散度大于0表示流体流出M点，小于0表示流体流入M点

如果散度=0，我们把这个向量场称为无源场













---

PBD

1. 基于力的动力学：
   物理思想是：任何物体都可以用约束连接的一组粒子来表示，然后就可以用约束投影来代替传统的求力和数值积分的操作
   TODO：愤怒的小鸟碰撞图
2. 
3. 



---

待解决问题：

内力和外力的区分：是基于单个粒子还是整个系统

